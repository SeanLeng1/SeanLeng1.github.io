<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin SEO -->





<title>Jixuan Leng - Homepage</title>







<meta property="og:locale" content="en">
<meta property="og:site_name" content="Jixuan Leng">
<meta property="og:title" content="Jixuan Leng">


  <link rel="canonical" href="https://github.com/pages/SeanLeng1/SeanLeng1.github.io/publications/">
  <meta property="og:url" content="https://github.com/pages/SeanLeng1/SeanLeng1.github.io/publications/">











<!-- end SEO -->


<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="manifest" href="/images/site.webmanifest">

<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="/assets/css/academicons.css"/>

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- end custom head snippets -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Move the overlay to the body
    const overlay = document.getElementById('wechat-qr-overlay');
    if (overlay) {
      document.body.appendChild(overlay);
    }
  
    window.toggleWeChatQR = function() {
      const overlay = document.getElementById('wechat-qr-overlay');
      if (overlay.style.display === 'none' || !overlay.style.display) {
        overlay.style.display = 'block';
        document.body.style.overflow = 'hidden';
      } else {
        overlay.style.display = 'none';
        document.body.style.overflow = '';
      }
    };
  });
  </script>

<script>
  function openDeadlinesModal() {
      const modal = document.getElementById('deadlines-modal');
      if (modal) {
          modal.style.display = 'block';
          document.body.style.overflow = 'hidden';
      }
  }
  
  function closeDeadlinesModal() {
      const modal = document.getElementById('deadlines-modal');
      if (modal) {
          modal.style.display = 'none';
          document.body.style.overflow = '';
      }
  }
  
  document.addEventListener('DOMContentLoaded', function() {
      // Handle ESC key
      document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
              closeDeadlinesModal();
          }
      });
  
      // Handle click outside modal
      const modal = document.getElementById('deadlines-modal');
      if (modal) {
          modal.addEventListener('click', function(e) {
              if (e.target === modal) {
                  closeDeadlinesModal();
              }
          });
      }
  });
  </script>

  </head>

  <body class="pubspage">

    <div id="page-loader" aria-live="polite" aria-label="Page loading">
      <span class="loader-progress" id="page-loader-progress">0 %</span>
    </div>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

    <div id="main" role="main">
      
    
      <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
        <meta itemprop="headline" content="Full Publications">
        <div class="page__inner-wrap">
          <section class="page__content" itemprop="text">
            
<div class="pubs-page">
  <div class="pubs-frame">
    <div class="pubs-hero">
      <div class="pubs-hero__text">
        <h1>Full Publications</h1>
        <p class="pubs-hero__lede">
          Browse every paper with quick PDF previews. Use the year strip to jump between cohorts. <em>Please use Menu to go back.</em>
        </p>
      </div>
      <div class="pubs-hero__badge">Updated Feb 2026</div>
      <button class="pubs-menu-toggle" aria-expanded="false" aria-controls="pubs-menu-panel" title="Toggle menu">
        ‚ò∞ Menu
      </button>
    </div>

    <aside class="pubs-menu" id="pubs-menu-panel" aria-hidden="true">
      <div class="pubs-menu__title">Menu</div>
      <a class="pubs-menu__link" href="/">Home</a>
      <a class="pubs-menu__link" href="#pubs-grid">Publications</a>
      <a class="pubs-menu__link" href="https://scholar.google.com/citations?user=Jyqbex4AAAAJ" target="_blank" rel="noopener">Google Scholar</a>
      <div class="pubs-menu__years">
        <div class="pubs-menu__years-title">Years</div>
        
          <a class="pubs-menu__link" href="#year-2026">2026</a>
        
          <a class="pubs-menu__link" href="#year-2025">2025</a>
        
          <a class="pubs-menu__link" href="#year-2024">2024</a>
        
      </div>
    </aside>

    <div class="pubs-shell">
      <div class="pubs-main">
        <div class="pubs-filter" role="tablist" aria-label="Filter publications by year">
          <button class="year-chip is-active" data-year="all" role="tab" aria-selected="true">All</button>
          
            <button class="year-chip" data-year="2026" role="tab" aria-selected="false">2026</button>
          
            <button class="year-chip" data-year="2025" role="tab" aria-selected="false">2025</button>
          
            <button class="year-chip" data-year="2024" role="tab" aria-selected="false">2024</button>
          
        </div>

        <div class="pubs-collection" id="pubs-grid">
          
            <section class="pubs-year-block" data-year="2026" id="year-2026">
              <header class="pubs-year-heading">
                <div class="pubs-year-heading__pill">2026</div>
                <div class="pubs-year-heading__line"></div>
              </header>
              <div class="pubs-grid">
                <ol class="bibliography"><li>















<div class="pub-card" data-year="2026">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2026</span>
    <div class="pub-card__title">Efficient Test-Time Scaling via Self-Calibration</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Chengsong Huang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Langlin Huang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author pub-card__author--me">Jixuan Leng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Jiacheng Liu</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Jiaxin Huang</span>
      
      
    
      
    </div>
    
    <div class="pub-card__venue">
      
        <span class="pub-card__abbr">ICLR</span>
        International Conference on Learning Representations (ICLR)
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="https://arxiv.org/pdf/2503.00031.pdf#toolbar=0&amp;view=FitH" title="Efficient Test-Time Scaling via Self-Calibration preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="https://arxiv.org/pdf/2503.00031.pdf" target="_blank" rel="noopener">PDF</a>
    <a class="pub-card__link" href="https://github.com/Chengsong-Huang/Self-Calibration" target="_blank" rel="noopener">Code</a>
    
  </div>
</div>
</li></ol>
              </div>
            </section>
          
            <section class="pubs-year-block" data-year="2025" id="year-2025">
              <header class="pubs-year-heading">
                <div class="pubs-year-heading__pill">2025</div>
                <div class="pubs-year-heading__line"></div>
              </header>
              <div class="pubs-grid">
                <ol class="bibliography"><li>















<div class="pub-card" data-year="2025">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2025</span>
    <div class="pub-card__title">Reliable and Responsible Foundation Models</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Xinyu Yang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Junlin Han</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Rishi Bommasani</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Jinqi Luo</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Wenjie Qu</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Wangchunshu Zhou</span>
      
      
    
      
        
      
        <span class="pub-card__more">‚Ä¶ (full author list hidden)</span>
      
    </div>
    
    <div class="pub-card__venue">
      
        
        Transactions on Machine Learning Research (TMLR)
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="/images/paper_preview/4644_Reliable_and_Responsible_.pdf#toolbar=0&amp;view=FitH" title="Reliable and Responsible Foundation Models preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="/images/paper_preview/4644_Reliable_and_Responsible_.pdf" target="_blank" rel="noopener">PDF</a>
    
    
  </div>
</div>
</li>
<li>















<div class="pub-card" data-year="2025">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2025</span>
    <div class="pub-card__title">POSS: Position Specialist Generates Better Draft for Speculative Decoding</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Langlin Huang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Chengsong Huang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author pub-card__author--me">Jixuan Leng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Di Huang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Jiaxin Huang</span>
      
      
    
      
    </div>
    
    <div class="pub-card__venue">
      
        <em><b>Preprint (2025)</b></em>
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="https://arxiv.org/pdf/2506.03566.pdf#toolbar=0&amp;view=FitH" title="POSS: Position Specialist Generates Better Draft for Speculative Decoding preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="https://arxiv.org/pdf/2506.03566.pdf" target="_blank" rel="noopener">PDF</a>
    <a class="pub-card__link" href="https://github.com/shrango/PosS" target="_blank" rel="noopener">Code</a>
    
  </div>
</div>
</li>
<li>















<div class="pub-card" data-year="2025">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2025</span>
    <div class="pub-card__title">Semi-structured LLM Reasoners Can Be Rigorously Audited</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author pub-card__author--me">Jixuan Leng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Cassandra A. Cohen</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Zhixian Zhang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Chenyan Xiong</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">William W. Cohen</span>
      
      
    
      
    </div>
    
    <div class="pub-card__venue">
      
        <em><b>Preprint (2025)</b></em>
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="https://arxiv.org/pdf/2505.24217.pdf#toolbar=0&amp;view=FitH" title="Semi-structured LLM Reasoners Can Be Rigorously Audited preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="https://arxiv.org/pdf/2505.24217.pdf" target="_blank" rel="noopener">PDF</a>
    <a class="pub-card__link" href="https://github.com/wwcohen/doctest-prompting" target="_blank" rel="noopener">Code</a>
    
  </div>
</div>
</li>
<li>















<div class="pub-card" data-year="2025">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2025</span>
    <div class="pub-card__title">CrossWordBench: Evaluating the Reasoning Capabilities of LLMs and LVLMs with Controllable Puzzle Generation</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author pub-card__author--me">Jixuan Leng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Chengsong Huang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Langlin Huang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Bill Yuchen Lin</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">William W. Cohen</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Haohan Wang</span>
      
      
    
      
        
      
        <span class="pub-card__more">‚Ä¶ (full author list hidden)</span>
      
    </div>
    
    <div class="pub-card__venue">
      
        <span class="pub-card__abbr">COLM</span>
        Second Conference on Language Modeling (COLM)
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="https://arxiv.org/pdf/2504.00043.pdf#toolbar=0&amp;view=FitH" title="CrossWordBench: Evaluating the Reasoning Capabilities of LLMs and LVLMs with Controllable Puzzle Generation preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="https://arxiv.org/pdf/2504.00043.pdf" target="_blank" rel="noopener">PDF</a>
    <a class="pub-card__link" href="https://github.com/SeanLeng1/CrossWordBench" target="_blank" rel="noopener">Code</a>
    <a class="pub-card__link" href="https://huggingface.co/datasets/HINT-lab/CrossWordBench" target="_blank" rel="noopener">Data</a>
  </div>
</div>
</li>
<li>















<div class="pub-card" data-year="2025">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2025</span>
    <div class="pub-card__title">Taming Overconfidence in LLMs: Reward Calibration in RLHF</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author pub-card__author--me">Jixuan Leng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Chengsong Huang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Banghua Zhu</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Jiaxin Huang</span>
      
      
    
      
    </div>
    
    <div class="pub-card__venue">
      
        <span class="pub-card__abbr">ICLR</span>
        International Conference on Learning Representations (ICLR)
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="https://arxiv.org/pdf/2410.09724.pdf#toolbar=0&amp;view=FitH" title="Taming Overconfidence in LLMs: Reward Calibration in RLHF preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="https://arxiv.org/pdf/2410.09724.pdf" target="_blank" rel="noopener">PDF</a>
    <a class="pub-card__link" href="https://github.com/SeanLeng1/Reward-Calibration" target="_blank" rel="noopener">Code</a>
    
  </div>
</div>
</li></ol>
              </div>
            </section>
          
            <section class="pubs-year-block" data-year="2024" id="year-2024">
              <header class="pubs-year-heading">
                <div class="pubs-year-heading__pill">2024</div>
                <div class="pubs-year-heading__line"></div>
              </header>
              <div class="pubs-grid">
                <ol class="bibliography"><li>















<div class="pub-card" data-year="2024">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2024</span>
    <div class="pub-card__title">S¬≤FT: Efficient, Scalable and Generalizable LLM Fine-tuning by Structured Sparsity</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Xinyu Yang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author pub-card__author--me">Jixuan Leng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Geyang Guo</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Jiawei Zhao</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Ryumei Nakada</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Linjun Zhang</span>
      
      
    
      
        
      
        <span class="pub-card__more">‚Ä¶ (full author list hidden)</span>
      
    </div>
    
    <div class="pub-card__venue">
      
        <span class="pub-card__abbr">NeurIPS</span>
        Conference on Neural Information Processing Systems (NeurIPS)
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="https://arxiv.org/pdf/2412.06289.pdf#toolbar=0&amp;view=FitH" title="S¬≤FT: Efficient, Scalable and Generalizable LLM Fine-tuning by Structured Sparsity preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="https://arxiv.org/pdf/2412.06289.pdf" target="_blank" rel="noopener">PDF</a>
    <a class="pub-card__link" href="https://infini-ai-lab.github.io/S2FT-Page/" target="_blank" rel="noopener">Code</a>
    
  </div>
</div>
</li>
<li>















<div class="pub-card" data-year="2024">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2024</span>
    <div class="pub-card__title">Development of UroSAM: A Machine Learning Model to Automatically Identify Kidney Stone Composition from Endoscopic Video</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author pub-card__author--me">Jixuan Leng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Junfei Liu</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Galen Cheng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Haohan Wang</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Scott Quarrier</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Jiebo Luo</span>
      
      
    
      
        
      
        <span class="pub-card__more">‚Ä¶ (full author list hidden)</span>
      
    </div>
    
    <div class="pub-card__venue">
      
        <span class="pub-card__abbr">J.Endourol.</span>
        Journal of Endourology
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="/images/paper_preview/leng-et-al-2024-development-of-urosam-a-machine-learning-model-to-automatically-identify-kidney-stone-composition-from.pdf#toolbar=0&amp;view=FitH" title="Development of UroSAM: A Machine Learning Model to Automatically Identify Kidney Stone Composition from Endoscopic Video preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="/images/paper_preview/leng-et-al-2024-development-of-urosam-a-machine-learning-model-to-automatically-identify-kidney-stone-composition-from.pdf" target="_blank" rel="noopener">PDF</a>
    
    
  </div>
</div>
</li>
<li>















<div class="pub-card" data-year="2024">
  <div class="pub-card__meta">
    <span class="pub-card__pill">2024</span>
    <div class="pub-card__title">Choosing Wisely and Learning Deeply: Selective Cross-Modality Distillation via CLIP for Domain Generalization</div>
    <div class="pub-card__authors">
      
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author pub-card__author--me">Jixuan Leng</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Yijiang Li</span>
      
      , 
    
      
      
      
      
      
      
      
      
      
      <span class="pub-card__author">Haohan Wang</span>
      
      
    
      
    </div>
    
    <div class="pub-card__venue">
      
        <span class="pub-card__abbr">TMLR</span>
        Transactions on Machine Learning Research (TMLR)
      
    </div>
  </div>

  <div class="pub-card__media">
    
      <iframe src="https://arxiv.org/pdf/2311.15145.pdf#toolbar=0&amp;view=FitH" title="Choosing Wisely and Learning Deeply: Selective Cross-Modality Distillation via CLIP for Domain Generalization preview" loading="lazy"></iframe>
    
  </div>

  <div class="pub-card__links">
    <a class="pub-card__link" href="https://arxiv.org/pdf/2311.15145.pdf" target="_blank" rel="noopener">PDF</a>
    <a class="pub-card__link" href="https://github.com/SeanLeng1/SCMD" target="_blank" rel="noopener">Code</a>
    
  </div>
</div>
</li></ol>
              </div>
            </section>
          
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    const chips = Array.from(document.querySelectorAll('.year-chip'));
    const yearBlocks = Array.from(document.querySelectorAll('.pubs-year-block'));
    const menu = document.querySelector('.pubs-menu');
    const toggle = document.querySelector('.pubs-menu-toggle');

    const placeMenu = () => {
      if (!menu || !toggle) return;
      const rect = toggle.getBoundingClientRect();
      const menuWidth = menu.offsetWidth || 260;
      const horizontalPadding = 12;
      const viewportWidth = window.innerWidth;

      // Âú®ÁßªÂä®Á´ØÔºåmenuÈù†Âè≥ÂØπÈΩê
      if (viewportWidth < 768) {
        const right = Math.min(horizontalPadding, viewportWidth - rect.right);
        menu.style.left = 'auto';
        menu.style.right = `${right}px`;
      } else {
        const left = Math.max(horizontalPadding, rect.right - menuWidth);
        menu.style.left = `${left}px`;
        menu.style.right = 'auto';
      }

      const top = rect.bottom + 12;
      menu.style.top = `${top}px`;
    };

    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        const year = chip.dataset.year;
        chips.forEach(c => {
          c.classList.toggle('is-active', c === chip);
          c.setAttribute('aria-selected', c === chip ? 'true' : 'false');
        });

        yearBlocks.forEach(block => {
          if (year === 'all' || block.dataset.year === year) {
            block.style.display = '';
          } else {
            block.style.display = 'none';
          }
        });

        if (year === 'all') {
          document.getElementById('pubs-grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
          const target = document.getElementById(`year-${year}`);
          if (target) {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
      });
    });

    if (toggle && menu) {
      let hoverTimeout;
      const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

      const openMenu = () => {
        clearTimeout(hoverTimeout);
        menu.classList.add('is-open');
        toggle.setAttribute('aria-expanded', 'true');
        menu.setAttribute('aria-hidden', 'false');
        placeMenu();
      };

      const closeMenu = () => {
        hoverTimeout = setTimeout(() => {
          menu.classList.remove('is-open');
          toggle.setAttribute('aria-expanded', 'false');
          menu.setAttribute('aria-hidden', 'true');
        }, 150);
      };

      const toggleMenu = (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (menu.classList.contains('is-open')) {
          menu.classList.remove('is-open');
          toggle.setAttribute('aria-expanded', 'false');
          menu.setAttribute('aria-hidden', 'true');
        } else {
          openMenu();
        }
      };

      if (isTouchDevice) {
        // Ëß¶Â±èËÆæÂ§áÔºöÁÇπÂáªÂàáÊç¢
        toggle.addEventListener('click', toggleMenu);

        // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠
        document.addEventListener('click', (e) => {
          if (!menu.contains(e.target) && !toggle.contains(e.target)) {
            if (menu.classList.contains('is-open')) {
              menu.classList.remove('is-open');
              toggle.setAttribute('aria-expanded', 'false');
              menu.setAttribute('aria-hidden', 'true');
            }
          }
        });
      } else {
        // Ê°åÈù¢ËÆæÂ§áÔºöhoverÊâìÂºÄ
        toggle.addEventListener('mouseenter', openMenu);
        toggle.addEventListener('mouseleave', closeMenu);

        menu.addEventListener('mouseenter', () => {
          clearTimeout(hoverTimeout);
        });
        menu.addEventListener('mouseleave', closeMenu);
      }

      window.addEventListener('resize', () => {
        if (menu.classList.contains('is-open')) placeMenu();
      });
      window.addEventListener('scroll', () => {
        if (menu.classList.contains('is-open')) placeMenu();
      }, { passive: true });
    }
  })();
</script>


          </section>
        </div>
      </article>
    </div>

    <!-- Music Player (outside of SPA content area) -->
    <!-- NetEase Music Player Component -->

<!-- Preconnect to CDNs -->
<link rel="preconnect" href="https://cdnjs.cloudflare.com">

<!-- Defer CSS loading until needed -->
<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.css"></noscript>

<style>
  /* Floating Music Player */
  #music-floating {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(0, 0, 0, 0.05);
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    will-change: width, height, border-radius, opacity, transform;
    opacity: 0.95;
    z-index: 100;
    touch-action: none;
    overflow: hidden;
  }

  #music-floating:hover {
    opacity: 1;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(0, 0, 0, 0.08);
    transform: scale(1.05);
  }

  #music-floating.dragging {
    transition: none;
    opacity: 1;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }

  #music-floating .content {
    width: 100%;
    height: 100%;
    border-radius: inherit;
    overflow: hidden;
    position: relative;
  }

  #music-floating.expand-left .content {
    transform-origin: right center;
  }

  #music-floating.expand-right .content {
    transform-origin: left center;
  }

  #music-floating.expanded {
    width: min(540px, 92vw);
    height: 360px;
    border-radius: 20px;
    opacity: 1;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(0, 0, 0, 0.1);
  }

  #music-floating.expanded:hover {
    transform: none;
  }

  /* APlayer Container Styling */
  #music-player {
    display: none;
    width: 100%;
    height: 100%;
    padding: 16px;
    box-sizing: border-box;
    background: linear-gradient(135deg, #fafafa 0%, #f0f0f0 100%);
  }

  #music-floating.expanded #music-player {
    display: block;
  }

  #music-floating.expanded #music-icon {
    display: none;
  }

  /* Icon Styling */
  #music-icon {
    text-align: center;
    font-size: 14px;
    color: #333;
    line-height: 60px;
    height: 100%;
    width: 100%;
    position: relative;
  }

  #music-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-radius: 50%;
    transition: transform 0.3s ease;
  }

  #music-floating:hover #music-icon img {
    transform: rotate(5deg) scale(1.1);
  }

  /* Now Playing Ticker */
  #music-nowplaying {
    display: none;
    position: absolute;
    bottom: -22px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 11px;
    color: #666;
    white-space: nowrap;
    max-width: 260px;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.95);
    padding: 4px 12px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  #music-nowplaying span {
    display: inline-block;
    padding-left: 100%;
    animation: ticker 15s linear infinite;
  }

  @keyframes ticker {
    0%   { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }

  /* Loading Animation - Rotate the icon */
  #music-floating.loading #music-icon img {
    animation: spin-icon 5s linear infinite;
  }

  @keyframes spin-icon {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* APlayer Custom Styling */
  .aplayer {
    box-shadow: none !important;
    margin: 0 !important;
    height: 100% !important;
    background: transparent !important;
    border-radius: 12px !important;
  }

  .aplayer .aplayer-body {
    background: transparent !important;
  }

  .aplayer .aplayer-list {
    background: rgba(255, 255, 255, 0.5) !important;
    border-radius: 8px !important;
    margin-top: 8px !important;
  }

  .aplayer .aplayer-list ol li {
    border-top: 1px solid rgba(0, 0, 0, 0.05) !important;
  }

  .aplayer .aplayer-list ol li:hover {
    background: rgba(194, 12, 12, 0.05) !important;
  }

  .aplayer .aplayer-list ol li.aplayer-list-light {
    background: rgba(194, 12, 12, 0.1) !important;
  }

  /* Mobile Responsive */
  @media only screen and (max-width: 768px) {
    #music-floating.expanded {
      width: 92vw;
      height: 340px;
      position: fixed;
    }

    #music-player {
      padding: 12px;
    }

    #music-nowplaying {
      max-width: 200px;
      font-size: 10px;
    }
  }
</style>

<!-- Floating Music Player -->
<div id="music-floating-container"></div>

<script>
  (function() {
    // Prevent multiple initializations (important for SPA)
    if (window.musicPlayerInitialized) {
      console.log('Music player already initialized, skipping...');
      return;
    }
    window.musicPlayerInitialized = true;

    // Create the player HTML dynamically (only once)
    const container = document.getElementById('music-floating-container');
    if (!container) {
      console.error('Music player container not found');
      return;
    }

    container.innerHTML = `
      <div id="music-floating">
        <div class="content">
          <div id="music-icon">
            <img src="/images/Isla.png" alt="Music Player">
          </div>
          <div id="music-player">
            <div id="aplayer"></div>
          </div>
          <div id="music-nowplaying"><span></span></div>
        </div>
      </div>
    `;

    const musicFloating = document.getElementById('music-floating');
    const nowPlaying = document.getElementById('music-nowplaying');

    // Store state globally to persist across SPA navigation
    window.musicPlayerState = window.musicPlayerState || {
      playerInitialized: false,
      scriptsLoaded: false,
      savedPosition: { top: '20px', right: '20px', bottom: '', left: '' },
      currentLimit: 10,  // Start with fewer songs for faster initial load
      maxLimit: 200,
      aplayerInstance: null
    };

    // Shorthand references
    let playerInitialized = window.musicPlayerState.playerInitialized;
    let scriptsLoaded = window.musicPlayerState.scriptsLoaded;
    let savedPosition = window.musicPlayerState.savedPosition;
    let currentLimit = window.musicPlayerState.currentLimit;
    let maxLimit = window.musicPlayerState.maxLimit;
    let aplayerInstance = window.musicPlayerState.aplayerInstance;

    function loadScripts(callback) {
      if (scriptsLoaded) {
        callback();
        return;
      }
      const aplayerScript = document.createElement('script');
      aplayerScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/aplayer/1.10.1/APlayer.min.js';
      aplayerScript.async = true;

      const metingScript = document.createElement('script');
      metingScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/meting/2.0.1/Meting.min.js';
      metingScript.async = true;

      aplayerScript.onload = function() {
        document.body.appendChild(metingScript);
      };
      metingScript.onload = function() {
        scriptsLoaded = window.musicPlayerState.scriptsLoaded = true;
        callback();
      };

      document.body.appendChild(aplayerScript);
    }

    function initializePlayer() {
      if (playerInitialized) return;
      musicFloating.classList.add('loading');
      loadScripts(function() {
        const metingElement = document.createElement('meting-js');
        metingElement.setAttribute('server', 'netease');
        metingElement.setAttribute('type', 'playlist');
        metingElement.setAttribute('id', '602810440');
        metingElement.setAttribute('autoplay', 'false');
        metingElement.setAttribute('theme', '#C20C0C');
        metingElement.setAttribute('limit', currentLimit.toString());
        metingElement.setAttribute('volume', '0.1');
        document.getElementById('aplayer').appendChild(metingElement);

        setTimeout(function() {
          const checkAPlayer = setInterval(function() {
            if (window.aplayer && window.aplayer.audio) {
              clearInterval(checkAPlayer);
              aplayerInstance = window.musicPlayerState.aplayerInstance = window.aplayer;
              playerInitialized = window.musicPlayerState.playerInitialized = true;
              musicFloating.classList.remove('loading');
              if (nowPlaying) nowPlaying.style.display = 'block';

              console.log('üéµ Music player ready with', currentLimit, 'songs');
              setupAPlayerEvents();
              setupLazyLoad();
            }
          }, 100);  // Check more frequently (was 200ms)
        }, 500);  // Start checking sooner (was 1000ms)
      });
    }

    function setupLazyLoad() {
      const { scrollContainer, playlistList } = getPlaylistElements();
      if (!scrollContainer || !playlistList) {
        console.log('‚è≥ Waiting for playlist element...');
        setTimeout(setupLazyLoad, 500);
        return;
      }

      console.log('‚úÖ Lazy load enabled - scroll to bottom to load more songs');

      if (lazyLoadScrollContainer && lazyLoadScrollHandler) {
        lazyLoadScrollContainer.removeEventListener('scroll', lazyLoadScrollHandler);
      }

      const containerToUse = scrollContainer;
      lazyLoadScrollContainer = containerToUse;
      lazyLoadScrollHandler = function() {
        const scrollTop = containerToUse.scrollTop;
        const scrollHeight = containerToUse.scrollHeight;
        const clientHeight = containerToUse.clientHeight;
        const scrollBottom = scrollHeight - scrollTop - clientHeight;

        // Debug: log when close to bottom
        if (scrollBottom < 150 && scrollBottom > 50) {
          console.log('üìú Scroll position:', scrollBottom, 'px from bottom');
        }

        if (scrollBottom < 100) {
          loadMoreSongs();
        }
      };

      containerToUse.addEventListener('scroll', lazyLoadScrollHandler);
    }

    let isLoadingMore = false;
    let lazyLoadScrollContainer = null;
    let lazyLoadScrollHandler = null;

    function getPlaylistElements() {
      const playlistWrapper = document.querySelector('.aplayer-list');
      if (!playlistWrapper) {
        return { scrollContainer: null, playlistList: null };
      }
      const scrollContainer = playlistWrapper.querySelector('.aplayer-list-body') ||
        playlistWrapper.querySelector('.aplayer-list-main') ||
        playlistWrapper;
      const playlistList = playlistWrapper.querySelector('ol') ||
        playlistWrapper.querySelector('ul');
      return { scrollContainer, playlistList };
    }

    function loadMoreSongs() {
      if (currentLimit >= maxLimit || isLoadingMore) return;

      const newLimit = Math.min(currentLimit + 10, maxLimit);  // Load 10 at a time instead of 20
      if (newLimit === currentLimit) return;

      isLoadingMore = true;
      console.log('üì• Loading more songs:', currentLimit, '‚Üí', newLimit);

      // Show loading indicator
      const { playlistList } = getPlaylistElements();
      if (playlistList) {
        const loadingItem = document.createElement('li');
        loadingItem.className = 'lazy-loading-indicator';
        loadingItem.innerHTML = '<span style="padding: 10px; color: #999;">Loading more songs...</span>';
        playlistList.appendChild(loadingItem);
      }

      currentLimit = window.musicPlayerState.currentLimit = newLimit;

      const aplayerContainer = document.getElementById('aplayer');
      const metingElement = aplayerContainer.querySelector('meting-js');
      if (metingElement) {
        metingElement.setAttribute('limit', currentLimit.toString());
        const parent = metingElement.parentNode;
        const clone = metingElement.cloneNode(true);
        parent.removeChild(metingElement);
        setTimeout(function() {
          parent.appendChild(clone);
          setTimeout(function() {
            // Remove loading indicator
            const loadingIndicator = document.querySelector('.lazy-loading-indicator');
            if (loadingIndicator) loadingIndicator.remove();

            setupLazyLoad();
            isLoadingMore = false;
            console.log('‚úÖ Loaded', newLimit, 'songs');
          }, 1000);  // Reduced from 1500ms to 1000ms
        }, 50);  // Reduced from 100ms to 50ms
      }
    }

    function setupAPlayerEvents() {
      if (!aplayerInstance) {
        console.error('APlayer instance not found');
        return;
      }

      console.log('Setting up APlayer event listeners');

      aplayerInstance.on('play', function() {
        console.log('APlayer: play event fired');
        updateNowPlaying();
      });

      aplayerInstance.on('pause', function() {
        console.log('APlayer: pause event fired');
      });

      aplayerInstance.on('ended', function() {
        console.log('APlayer: ended event fired');
      });

      aplayerInstance.on('loadeddata', function() {
        console.log('APlayer: loadeddata event fired');
        updateNowPlaying();
      });

      aplayerInstance.on('listswitch', function(index) {
        console.log('APlayer: listswitch event fired, index:', index);
        setTimeout(() => {
          updateNowPlaying();
        }, 400);
      });

      updateNowPlaying();
    }

    function handlePlayerToggle() {
      if (!musicFloating.classList.contains('expanded')) {
        const isMobile = window.innerWidth < 769;
        const targetWidth = isMobile ? Math.min(window.innerWidth - 24, 540) : 540;
        const targetHeight = isMobile ? 340 : 360;
        const padding = 12;
        const rect = musicFloating.getBoundingClientRect();

        const spaceLeft = rect.left;
        const spaceRight = window.innerWidth - rect.right;
        const spaceAbove = rect.top;
        const spaceBelow = window.innerHeight - rect.bottom;

        const expandLeft = spaceLeft > spaceRight;
        musicFloating.classList.remove('expand-left', 'expand-right');
        musicFloating.classList.add(expandLeft ? 'expand-left' : 'expand-right');

        let topPos;
        if (spaceBelow >= targetHeight + padding) {
          topPos = rect.top;
        } else if (spaceAbove >= targetHeight + padding) {
          topPos = rect.bottom - targetHeight;
        } else {
          topPos = Math.max(padding, Math.min(rect.top, window.innerHeight - targetHeight - padding));
        }

        let leftPos;
        if (expandLeft) {
          leftPos = rect.right - targetWidth;
          leftPos = Math.max(padding, leftPos);
        } else {
          leftPos = rect.left;
          leftPos = Math.min(leftPos, window.innerWidth - targetWidth - padding);
        }

        musicFloating.style.top = `${topPos}px`;
        musicFloating.style.left = `${leftPos}px`;
        musicFloating.style.right = 'auto';
        musicFloating.style.bottom = 'auto';

        musicFloating.style.width = `${targetWidth}px`;
        musicFloating.style.height = `${targetHeight}px`;
        musicFloating.classList.add('expanded');
        if (!playerInitialized) initializePlayer();
      } else {
        collapsePlayer();
      }
    }

    function collapsePlayer() {
      musicFloating.classList.remove('expanded');
      musicFloating.style.width = '';
      musicFloating.style.height = '';
      musicFloating.style.top = savedPosition.top;
      musicFloating.style.bottom = savedPosition.bottom;
      musicFloating.style.left = savedPosition.left;
      musicFloating.style.right = savedPosition.right;
    }

    function updateNowPlaying() {
      let title = '';
      let artist = '';

      if (aplayerInstance && aplayerInstance.list && aplayerInstance.list.audios) {
        const currentIndex = aplayerInstance.list.index;
        const currentAudio = aplayerInstance.list.audios[currentIndex];

        if (currentAudio) {
          title = currentAudio.name || currentAudio.title || '';
          artist = currentAudio.artist || '';
          console.log('Got song info from APlayer instance:', { title, artist, index: currentIndex });
        }
      }

      if (!title) {
        const titleEl = document.querySelector('.aplayer-title');
        const artistEl = document.querySelector('.aplayer-author');

        if (titleEl && titleEl.textContent) {
          title = titleEl.textContent.trim();
        }

        if (artistEl && artistEl.textContent) {
          artist = artistEl.textContent.trim();
        }

        if (title || artist) {
          console.log('Got song info from DOM:', { title, artist });
        }
      }

      if (nowPlaying) {
        const text = title ? `${title}${artist ? ' ‚Äî ' + artist : ''}` : '';
        nowPlaying.querySelector('span').textContent = text;
      }
    }

    // Dragging functionality
    let isDragging = false;
    let startX, startY, startRight, startBottom, startTop, startLeft;

    function handleDragStart(e) {
      if (musicFloating.classList.contains('expanded')) {
        if (e.target.closest('#music-icon')) {
          handlePlayerToggle();
        }
        return;
      }
      isDragging = true;
      musicFloating.classList.add('dragging');
      const style = window.getComputedStyle(musicFloating);
      const hasRight = style.right !== 'auto';
      const hasBottom = style.bottom !== 'auto';

      if (hasRight) {
        startRight = parseInt(style.right);
        startLeft = null;
      } else {
        startLeft = parseInt(style.left);
        startRight = null;
      }
      if (hasBottom) {
        startBottom = parseInt(style.bottom);
        startTop = null;
      } else {
        startTop = parseInt(style.top);
        startBottom = null;
      }

      if (e.type === 'mousedown') {
        startX = e.clientX;
        startY = e.clientY;
        document.addEventListener('mousemove', handleDragMove);
        document.addEventListener('mouseup', handleDragEnd);
      } else if (e.type === 'touchstart') {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        document.addEventListener('touchmove', handleDragMove, { passive: false });
        document.addEventListener('touchend', handleDragEnd);
      }
      e.preventDefault();
    }

    function handleDragMove(e) {
      if (!isDragging) return;
      let currentX, currentY;
      if (e.type === 'mousemove') {
        currentX = e.clientX;
        currentY = e.clientY;
      } else if (e.type === 'touchmove') {
        currentX = e.touches[0].clientX;
        currentY = e.touches[0].clientY;
        e.preventDefault();
      }
      const diffX = currentX - startX;
      const diffY = currentY - startY;

      if (startRight !== null) {
        musicFloating.style.right = Math.max(0, startRight - diffX) + 'px';
        musicFloating.style.left = 'auto';
      } else if (startLeft !== null) {
        musicFloating.style.left = Math.max(0, startLeft + diffX) + 'px';
        musicFloating.style.right = 'auto';
      }

      if (startBottom !== null) {
        musicFloating.style.bottom = Math.max(0, startBottom - diffY) + 'px';
        musicFloating.style.top = 'auto';
      } else if (startTop !== null) {
        musicFloating.style.top = Math.max(0, startTop + diffY) + 'px';
        musicFloating.style.bottom = 'auto';
      }
    }

    function handleDragEnd(e) {
      if (!isDragging) return;
      let wasDragged = false;
      if (e.type === 'mouseup') {
        const diffX = Math.abs(e.clientX - startX);
        const diffY = Math.abs(e.clientY - startY);
        wasDragged = (diffX > 5 || diffY > 5);
      } else if (e.type === 'touchend' && e.changedTouches && e.changedTouches.length > 0) {
        const diffX = Math.abs(e.changedTouches[0].clientX - startX);
        const diffY = Math.abs(e.changedTouches[0].clientY - startY);
        wasDragged = (diffX > 5 || diffY > 5);
      }

      isDragging = false;
      musicFloating.classList.remove('dragging');
      document.removeEventListener('mousemove', handleDragMove);
      document.removeEventListener('mouseup', handleDragEnd);
      document.removeEventListener('touchmove', handleDragMove);
      document.removeEventListener('touchend', handleDragEnd);

      if (wasDragged) {
        const style = window.getComputedStyle(musicFloating);
        savedPosition = {
          top: style.top !== 'auto' ? style.top : '',
          right: style.right !== 'auto' ? style.right : '',
          bottom: style.bottom !== 'auto' ? style.bottom : '',
          left: style.left !== 'auto' ? style.left : ''
        };
      } else {
        setTimeout(function() {
          handlePlayerToggle();
        }, 10);
      }
    }

    musicFloating.addEventListener('mousedown', handleDragStart);
    musicFloating.addEventListener('touchstart', handleDragStart, { passive: false });

    document.addEventListener('click', function(e) {
      if (!musicFloating.contains(e.target)) {
        collapsePlayer();
      }
    });

    document.getElementById('music-player').addEventListener('click', function(e) {
      e.stopPropagation();
    });

    // Initialize immediately if DOM is already ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        console.log('Music player DOM ready');
      });
    } else {
      console.log('Music player initialized (DOM already ready)');
    }
  })();
</script>


    <!-- Load modal scripts BEFORE SPA router so they can register handlers first -->
    <style>
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes scaleIn {
    from { 
      opacity: 0;
      transform: translate(-50%, -50%) scale(0.7);
    }
    to { 
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }
  }
  
  #wechat-qr-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    z-index: 99999;
    opacity: 0;
  }
  
  #wechat-qr {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 30px;
    border-radius: 12px;
    z-index: 100000;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    opacity: 0;
  }
  
  .close-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
  }
  
  .close-button:hover {
    background-color: rgba(0,0,0,0.1);
    color: #333;
  }
  
  .qr-image {
    width: 300px;
    height: 300px;
    object-fit: contain;
    display: block;
    border-radius: 8px;
    -webkit-user-select: none;
    user-select: none;
  }
  </style>
  
  <div id="wechat-qr-overlay">
    <div id="wechat-qr">
      <img class="qr-image" src="/images/wechat_public_account.jpg" alt="WeChat QR Code">
      <button class="close-button" onclick="closeOverlay()">√ó</button>
    </div>
  </div>
  
  <script>
  (function() {
    // Prevent multiple initializations
    if (window.wechatModalInitialized) {
      console.log('WeChat modal already initialized');
      return;
    }
    window.wechatModalInitialized = true;

    const overlay = document.getElementById('wechat-qr-overlay');
    const qr = document.getElementById('wechat-qr');
    let isClosing = false;

    // Make function globally accessible for SPA router
    window.handleWeChatClick = function handleWeChatClick(event) {
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation(); // Stop SPA router from intercepting
      if (!isClosing) {
        showOverlay();
      }
    };

    function showOverlay() {
      // Reset all states
      isClosing = false;
      overlay.style.display = 'block';
      document.body.style.overflow = 'hidden';

      // Force browser reflow
      void overlay.offsetWidth;
      void qr.offsetWidth;

      // Apply animations
      overlay.style.animation = 'fadeIn 0.3s ease-out forwards';
      qr.style.animation = 'scaleIn 0.3s ease-out forwards';
    }

    window.closeOverlay = function closeOverlay() {
      if (isClosing) return;
      isClosing = true;

      document.body.style.overflow = '';
      overlay.style.animation = 'fadeIn 0.3s ease-out reverse';
      qr.style.animation = 'scaleIn 0.3s ease-out reverse';

      setTimeout(() => {
        overlay.style.display = 'none';
        // Clear animation states
        overlay.style.animation = '';
        qr.style.animation = '';
        isClosing = false;
      }, 300);
    };

    // Close overlay when clicking outside
    overlay.addEventListener('click', function(event) {
      if (event.target === this && !isClosing) {
        window.closeOverlay();
      }
    });

    console.log('‚úì WeChat modal initialized');
  })();
  </script>
    <!-- Paper Preview Modal -->
<div id="previewModal" class="preview-modal">
  <div class="preview-content">
    <span class="preview-close-button">&times;</span>  <!-- Changed class name here -->
    <img id="previewImage" src="" alt="Preview">
  </div>
</div>

<style>
.preview-button {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background-color: rgb(222, 243, 253);
    padding: 2px 8px;
    border-radius: 4px;
    text-decoration: none;
    font-size: 0.9em;
    cursor: pointer;
    border: none;
    transition: background-color 0.2s ease;
  }

.preview-button:hover {
  background-color: rgb(255, 255, 255);
}

.preview-button::before {
  content: "üëÅÔ∏è"; /* Using eye emoji as icon */
  font-size: 1em;
}

.preview-modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0);
  transition: background-color 0.3s ease;
  opacity: 0;
}

.preview-modal.show {
  opacity: 1;
  background-color: rgba(0, 0, 0, 0.8);
}

.preview-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0.95);
  padding: 20px;
  max-width: 90vw;
  max-height: 90vh;
  text-align: center;
  transition: transform 0.3s ease, opacity 0.3s ease;
  opacity: 0;
}

.preview-modal.show .preview-content {
  transform: translate(-50%, -50%) scale(1);
  opacity: 1;
}

.preview-content img {
  width: auto;
  max-width: 100%;
  max-height: 70vh;
  object-fit: contain;
  background-color: white;
  border-radius: 4px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.preview-close-button {  /* Changed class name here */
  position: fixed;
  right: 30px;
  top: 20px;
  color: #fff;
  font-size: 40px;
  font-weight: bold;
  cursor: pointer;
  z-index: 1001;
  opacity: 0;
  transition: opacity 0.3s ease, color 0.2s ease;
  padding: 10px;
  line-height: 1;
}

.preview-modal.show .preview-close-button {  /* Changed class name here */
  opacity: 1;
}

.preview-close-button:hover {  /* Changed class name here */
  color: #fff;
}
</style>

<script>
(function() {
  // Prevent multiple initializations
  if (window.previewModalInitialized) {
    console.log('Preview modal already initialized');
    return;
  }
  window.previewModalInitialized = true;

  var modal = document.getElementById('previewModal');
  var modalContent = modal ? modal.querySelector('.preview-content') : null;
  var modalImg = document.getElementById('previewImage');
  var closeBtn = modal ? modal.querySelector('.preview-close-button') : null;
  if (!modal || !modalContent || !modalImg || !closeBtn) {
    console.warn('Preview modal elements not found');
    return;
  }

  var animationDuration = 300;
  var isTransitioning = false;

  function openModal(imageSrc) {
    if (!imageSrc || isTransitioning) return;
    isTransitioning = true;
    modalImg.src = imageSrc;
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden';

    void modal.offsetWidth;
    void modalContent.offsetWidth;

    modal.style.animation = 'fadeIn 0.3s ease-out forwards';
    modalContent.style.animation = 'slideIn 0.3s ease-out forwards';
    modal.classList.add('show');

    setTimeout(function() {
      isTransitioning = false;
    }, animationDuration);
  }

  function closeModal() {
    if (isTransitioning || modal.style.display !== 'block') return;
    isTransitioning = true;

    modal.style.animation = 'fadeOut 0.3s ease-out forwards';
    modalContent.style.animation = 'slideOut 0.3s ease-out forwards';

    setTimeout(function() {
      modal.classList.remove('show');
      modal.style.display = 'none';
      document.body.style.overflow = '';
      modalImg.src = '';
      modal.style.animation = '';
      modalContent.style.animation = '';
      isTransitioning = false;
    }, animationDuration);
  }

  // Use event delegation on document with capture phase to intercept before SPA router
  document.addEventListener('click', function(event) {
    var button = event.target.closest('.preview-button');
    if (!button) return;
    event.preventDefault();
    event.stopPropagation();
    event.stopImmediatePropagation(); // Stop SPA router from intercepting
    var previewSrc = button.getAttribute('data-preview');
    openModal(previewSrc);
  }, true); // Use capture phase

  closeBtn.addEventListener('click', function(event) {
    event.preventDefault();
    event.stopPropagation();
    closeModal();
  });

  modal.addEventListener('click', function(event) {
    if (event.target === modal) {
      closeModal();
    }
  });

  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
      closeModal();
    }
  });

  console.log('‚úì Preview modal initialized');
})();
</script>

    <style>
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translate(-50%, -45%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%);
  }
}

@keyframes fadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

@keyframes slideOut {
  from {
    opacity: 1;
    transform: translate(-50%, -50%);
  }
  to {
    opacity: 0;
    transform: translate(-50%, -45%);
  }
}

.contact-button {
  display: inline-block;
  background: #007bff;
  color: white;
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
  border: none;
  font-size: 16px;
  transition: background-color 0.2s;
  -webkit-tap-highlight-color: transparent;
}

.modal-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  z-index: 1000;
  opacity: 0;
}

.modal-content {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 8px;
  max-width: 600px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  z-index: 1001;
  opacity: 0;
}

.warning-message {
  text-align: center;
  margin-bottom: 20px;
  font-size: 18px;
  opacity: 1;
  transition: opacity 0.3s ease-out;
}

.contact-form {
  display: none;
  max-width: 100%;
  margin: 0;
  padding: 20px 0;
  opacity: 0;
  transition: opacity 0.3s ease-out;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: 500;
}

.form-control {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
  box-sizing: border-box;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.form-control:focus {
  border-color: #007bff;
  outline: none;
  box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
}

textarea.form-control {
  min-height: 120px;
  resize: vertical;
}

.submit-btn {
  background: #007bff;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  transition: background-color 0.2s;
}

.submit-btn:hover {
  background: #0056b3;
}

.close-button {
  position: absolute;
  right: 10px;
  top: 10px;
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #666;
  padding: 5px;
}

.close-button:hover {
  color: #333;
}
</style>

<!-- Contact Form Modal (outside #main to persist across SPA navigation) -->
<div id="contact-modal" class="modal-overlay">
  <div class="modal-content">
    <button type="button" class="close-button" data-contact="close">&times;</button>

    <div id="warning-message" class="warning-message">
      <h3>Contact Information</h3>
      <p>Please note that this contact form is for informal inquiries. I might not be able to respond to all messages.</p>
      <button type="button" class="contact-button" data-contact="continue">Continue</button>
    </div>

    <div id="contact-form" class="contact-form">
      <h3>Send Message</h3>
      <form action="https://formspree.io/f/xrbbwwdj" method="POST">
        <div class="form-group">
          <label for="name">Name</label>
          <input type="text" id="name" name="name" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" name="_replyto" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="subject">Subject</label>
          <input type="text" id="subject" name="_subject" class="form-control" required>
        </div>

        <div class="form-group">
          <label for="message">Message</label>
          <textarea id="message" name="message" class="form-control" required></textarea>
        </div>

        <button type="submit" class="submit-btn">Send Message</button>
      </form>
    </div>
  </div>
</div>


    <!-- Load main scripts -->
<script src="/assets/js/main.min.js"></script>
<script src="/assets/js/music-player-debug.js"></script>

<!-- Load SPA router LAST so it doesn't interfere with modal handlers -->
<!-- Modal handlers register with capture phase and stopImmediatePropagation -->
<script src="/assets/js/spa-router-aggressive.js"></script>



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', "");
</script>


<script>
    $(document).ready(function () {
        
        var gsDataBaseUrl = 'https://cdn.jsdelivr.net/gh/SeanLeng1/SeanLeng1.github.io@'
        
        $.getJSON(gsDataBaseUrl + "google-scholar-stats/gs_data.json", function (data) {
            var totalCitation = data['citedby']
            document.getElementById('total_cit').innerHTML = totalCitation;
            var citationEles = document.getElementsByClassName('show_paper_citations')
            Array.prototype.forEach.call(citationEles, element => {
                var paperId = element.getAttribute('data')
                var numCitations = data['publications'][paperId]['num_citations']
                element.innerHTML = '| Citations: ' + numCitations;
            });
        });
    })
</script>


    <script>
      (function() {
        var loader = document.getElementById('page-loader');
        var progress = document.getElementById('page-loader-progress');
        if (!loader || !progress) {
          return;
        }

        loader.style.display = 'flex';

        var value = 0;
        var finished = false;
        var intervalId = setInterval(function() {
          if (finished) {
            return;
          }
          value = Math.min(value + Math.random() * 12 + 5, 92);
          progress.textContent = Math.round(value) + ' %';
        }, 150);

        var finish = function() {
          if (finished) {
            return;
          }
          finished = true;
          clearInterval(intervalId);
          progress.textContent = '100 %';
          loader.classList.add('fade-out');
          setTimeout(function() {
            loader.remove();
          }, 450);
        };

        window.addEventListener('load', finish);
        setTimeout(function() {
          if (document.readyState === 'complete') {
            finish();
          }
        }, 1500);
      })();
    </script>
  </body>
</html>
